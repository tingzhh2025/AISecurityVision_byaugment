openapi: 3.0.3
info:
  title: AI Security Vision System API
  description: |
    AIå®‰å…¨è§†è§‰ç³»ç»Ÿçš„RESTful APIæ¥å£æ–‡æ¡£
    
    ## åŠŸèƒ½ç‰¹æ€§
    - ğŸ¥ æ‘„åƒå¤´ç®¡ç†å’ŒRTSPæµå¤„ç†
    - ğŸ¤– YOLOv8 AIç›®æ ‡æ£€æµ‹ (RKNN NPUåŠ é€Ÿ)
    - ğŸ‘¥ äººå‘˜ç»Ÿè®¡å’Œå¹´é¾„æ€§åˆ«è¯†åˆ«
    - ğŸš¨ æ™ºèƒ½æŠ¥è­¦å’Œäº‹ä»¶ç®¡ç†
    - ğŸ“¹ å½•åƒç®¡ç†å’Œå›æ”¾
    - ğŸ” JWTç”¨æˆ·è®¤è¯å’Œæˆæƒ
    - ğŸ“Š ç³»ç»Ÿç›‘æ§å’Œç»Ÿè®¡åˆ†æ
    
    ## æŠ€æœ¯æ¶æ„
    - **åç«¯**: C++ (RK3588å¹³å°)
    - **AIæ¨ç†**: RKNN NPU + YOLOv8
    - **æ•°æ®åº“**: SQLite3
    - **è®¤è¯**: JWT Token
    - **æµåª’ä½“**: MJPEG over HTTP
    
  version: 1.0.0
  contact:
    name: AI Security Vision Team
    email: support@aisecurityvision.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: å¼€å‘ç¯å¢ƒ
  - url: https://api.aisecurityvision.com
    description: ç”Ÿäº§ç¯å¢ƒ

tags:
  - name: System Management
    description: ç³»ç»Ÿç®¡ç†å’Œé…ç½®
  - name: Camera Management
    description: æ‘„åƒå¤´ç®¡ç†å’Œé…ç½®
  - name: AI Detection
    description: AIæ£€æµ‹å’Œé…ç½®
  - name: Person Statistics
    description: äººå‘˜ç»Ÿè®¡åŠŸèƒ½
  - name: Alarm Management
    description: æŠ¥è­¦ç®¡ç†
  - name: Recording Management
    description: å½•åƒç®¡ç†
  - name: Authentication
    description: ç”¨æˆ·è®¤è¯å’Œæˆæƒ
  - name: Network Management
    description: ç½‘ç»œç®¡ç†
  - name: ONVIF Discovery
    description: ONVIFè®¾å¤‡å‘ç°
  - name: Logs and Statistics
    description: æ—¥å¿—å’Œç»Ÿè®¡

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWTè®¤è¯ä»¤ç‰Œ

  schemas:
    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "é”™è¯¯æè¿°"
        error_code:
          type: integer
          example: 400
      required:
        - success
        - message

    Success:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "æ“ä½œæˆåŠŸ"
        data:
          type: object
      required:
        - success
        - message

    SystemStatus:
      type: object
      properties:
        status:
          type: string
          enum: [running, stopped, error]
          example: "running"
        uptime:
          type: integer
          description: ç³»ç»Ÿè¿è¡Œæ—¶é—´(ç§’)
          example: 3600
        version:
          type: string
          example: "1.0.0"
        cameras_active:
          type: integer
          example: 2
        ai_backend:
          type: string
          enum: [RKNN, OpenCV, TensorRT]
          example: "RKNN"

    SystemInfo:
      type: object
      properties:
        platform:
          type: string
          example: "RK3588"
        os:
          type: string
          example: "Ubuntu 20.04"
        cpu_cores:
          type: integer
          example: 8
        memory_total:
          type: string
          example: "8GB"
        npu_available:
          type: boolean
          example: true

    Camera:
      type: object
      properties:
        id:
          type: string
          example: "camera_01"
        name:
          type: string
          example: "å‰é—¨æ‘„åƒå¤´"
        rtsp_url:
          type: string
          example: "rtsp://admin:password@192.168.1.100:554/1/1"
        enabled:
          type: boolean
          example: true
        detection_enabled:
          type: boolean
          example: true
        mjpeg_port:
          type: integer
          example: 8161
        status:
          type: string
          enum: [connected, disconnected, error]
          example: "connected"
        resolution:
          type: string
          example: "1920x1080"
        fps:
          type: number
          format: float
          example: 25.0
      required:
        - id
        - name
        - rtsp_url

    DetectionConfig:
      type: object
      properties:
        enabled:
          type: boolean
          example: true
        confidence_threshold:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          example: 0.5
        nms_threshold:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          example: 0.4
        max_detections:
          type: integer
          minimum: 1
          maximum: 1000
          example: 100

    DetectionCategory:
      type: object
      properties:
        id:
          type: integer
          example: 0
        name:
          type: string
          example: "person"
        enabled:
          type: boolean
          example: true
        color:
          type: string
          example: "#FF0000"

    PersonStats:
      type: object
      properties:
        total_count:
          type: integer
          example: 150
        male_count:
          type: integer
          example: 80
        female_count:
          type: integer
          example: 70
        age_groups:
          type: object
          properties:
            child:
              type: integer
              example: 20
            adult:
              type: integer
              example: 100
            elderly:
              type: integer
              example: 30

    LoginRequest:
      type: object
      properties:
        username:
          type: string
          example: "admin"
        password:
          type: string
          example: "password123"
        expiration_hours:
          type: integer
          default: 24
          example: 24
      required:
        - username
        - password

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "ç™»å½•æˆåŠŸ"
        data:
          type: object
          properties:
            token:
              type: string
              example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
            user_id:
              type: string
              example: "user_001"
            username:
              type: string
              example: "admin"
            role:
              type: string
              example: "administrator"
            expires_at:
              type: string
              format: date-time
              example: "2024-01-02T12:00:00Z"

paths:
  /api/system/status:
    get:
      tags:
        - System Management
      summary: è·å–ç³»ç»ŸçŠ¶æ€
      description: è·å–ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ã€ç‰ˆæœ¬ä¿¡æ¯å’ŒåŸºæœ¬ç»Ÿè®¡
      responses:
        '200':
          description: ç³»ç»ŸçŠ¶æ€ä¿¡æ¯
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SystemStatus'

  /api/system/info:
    get:
      tags:
        - System Management
      summary: è·å–ç³»ç»Ÿä¿¡æ¯
      description: è·å–ç¡¬ä»¶å¹³å°ã€æ“ä½œç³»ç»Ÿç­‰è¯¦ç»†ä¿¡æ¯
      responses:
        '200':
          description: ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SystemInfo'

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: ç”¨æˆ·ç™»å½•
      description: ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ï¼Œè¿”å›JWTä»¤ç‰Œ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: ç™»å½•æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: è®¤è¯å¤±è´¥
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/cameras:
    get:
      tags:
        - Camera Management
      summary: è·å–æ‘„åƒå¤´åˆ—è¡¨
      description: è·å–æ‰€æœ‰å·²é…ç½®çš„æ‘„åƒå¤´ä¿¡æ¯
      security:
        - BearerAuth: []
      responses:
        '200':
          description: æ‘„åƒå¤´åˆ—è¡¨
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Camera'
    post:
      tags:
        - Camera Management
      summary: æ·»åŠ æ‘„åƒå¤´
      description: æ·»åŠ æ–°çš„æ‘„åƒå¤´é…ç½®
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Camera'
      responses:
        '201':
          description: æ‘„åƒå¤´æ·»åŠ æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/cameras/{id}:
    get:
      tags:
        - Camera Management
      summary: è·å–æŒ‡å®šæ‘„åƒå¤´ä¿¡æ¯
      description: æ ¹æ®IDè·å–æ‘„åƒå¤´è¯¦ç»†ä¿¡æ¯
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "camera_01"
      responses:
        '200':
          description: æ‘„åƒå¤´ä¿¡æ¯
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Camera'
        '404':
          description: æ‘„åƒå¤´ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      tags:
        - Camera Management
      summary: æ›´æ–°æ‘„åƒå¤´é…ç½®
      description: æ›´æ–°æŒ‡å®šæ‘„åƒå¤´çš„é…ç½®ä¿¡æ¯
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "camera_01"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Camera'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '404':
          description: æ‘„åƒå¤´ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags:
        - Camera Management
      summary: åˆ é™¤æ‘„åƒå¤´
      description: åˆ é™¤æŒ‡å®šçš„æ‘„åƒå¤´é…ç½®
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "camera_01"
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '404':
          description: æ‘„åƒå¤´ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/detection/config:
    get:
      tags:
        - AI Detection
      summary: è·å–æ£€æµ‹é…ç½®
      description: è·å–AIæ£€æµ‹çš„å…¨å±€é…ç½®å‚æ•°
      security:
        - BearerAuth: []
      responses:
        '200':
          description: æ£€æµ‹é…ç½®ä¿¡æ¯
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DetectionConfig'
    put:
      tags:
        - AI Detection
      summary: æ›´æ–°æ£€æµ‹é…ç½®
      description: æ›´æ–°AIæ£€æµ‹çš„å…¨å±€é…ç½®å‚æ•°
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DetectionConfig'
      responses:
        '200':
          description: é…ç½®æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'

  /api/detection/categories:
    get:
      tags:
        - AI Detection
      summary: è·å–æ£€æµ‹ç±»åˆ«
      description: è·å–å½“å‰å¯ç”¨çš„æ£€æµ‹ç±»åˆ«åˆ—è¡¨
      security:
        - BearerAuth: []
      responses:
        '200':
          description: æ£€æµ‹ç±»åˆ«åˆ—è¡¨
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/DetectionCategory'
    post:
      tags:
        - AI Detection
      summary: æ›´æ–°æ£€æµ‹ç±»åˆ«
      description: æ›´æ–°æ£€æµ‹ç±»åˆ«çš„å¯ç”¨çŠ¶æ€
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/DetectionCategory'
      responses:
        '200':
          description: ç±»åˆ«æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'

  /api/person-stats:
    get:
      tags:
        - Person Statistics
      summary: è·å–äººå‘˜ç»Ÿè®¡
      description: è·å–äººå‘˜æ£€æµ‹å’Œåˆ†æçš„ç»Ÿè®¡æ•°æ®
      security:
        - BearerAuth: []
      parameters:
        - name: camera_id
          in: query
          schema:
            type: string
          description: æŒ‡å®šæ‘„åƒå¤´IDï¼Œä¸æŒ‡å®šåˆ™è¿”å›å…¨éƒ¨
        - name: start_time
          in: query
          schema:
            type: string
            format: date-time
          description: ç»Ÿè®¡å¼€å§‹æ—¶é—´
        - name: end_time
          in: query
          schema:
            type: string
            format: date-time
          description: ç»Ÿè®¡ç»“æŸæ—¶é—´
      responses:
        '200':
          description: äººå‘˜ç»Ÿè®¡æ•°æ®
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PersonStats'
